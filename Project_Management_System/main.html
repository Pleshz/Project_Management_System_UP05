<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/sidebar.css">
    <title>Project Manager</title>
    <style>
      .pulse-animation {
        animation: pulseSidebarBtn 1.5s ease-in-out infinite;
        position: relative;
      }

      @keyframes pulseSidebarBtn {
        0% {
          box-shadow: 0 0 0 0 rgba(65, 145, 253, 0.7);
        }
        50% {
          box-shadow: 0 0 0 15px rgba(65, 145, 253, 0);
          transform: scale(1.1);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(65, 145, 253, 0);
          transform: scale(1);
        }
      }
    </style>
</head>
<body>
<div class="main-root-layout">
  <aside class="icon-sidebar">
    <div class="toggle-sidebar-btn" id="toggle-sidebar-btn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–µ–Ω—é" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–µ–Ω—é">‚áã</div>
    <nav class="icon-sidebar-nav sidebar-nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <ul>
        <li class="sidebar-btn active" data-section="profile" aria-label="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" title="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"><span class="nav-icon">üë§</span></li>
        <li class="sidebar-btn" data-section="projects" aria-label="–ü—Ä–æ–µ–∫—Ç—ã" title="–ü—Ä–æ–µ–∫—Ç—ã"><span class="nav-icon">üìÅ</span></li>
        <li class="sidebar-btn" data-section="tasks" aria-label="–ú–æ–∏ –∑–∞–¥–∞—á–∏" title="–ú–æ–∏ –∑–∞–¥–∞—á–∏"><span class="nav-icon">üìù</span></li>
        <li class="sidebar-btn" data-section="extra" aria-label="–ß—Ç–æ-—Ç–æ –µ—â—ë" title="–ß—Ç–æ-—Ç–æ –µ—â—ë"><span class="nav-icon">‚ö°</span></li>
      </ul>
    </nav>
    <div class="icon-sidebar-bottom">
      <button class="sidebar-btn theme-btn" id="theme-btn-sidebar" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"><span class="theme-icon">üåô</span></button>
    </div>
  </aside>
  <main class="main-content" id="app-content">
  </main>
</div>

<div class="modal-avatar-overlay" id="modal-avatar-overlay" style="display:none;">
  <div class="modal-avatar">
    <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</h3>
    <div class="avatar-choices">
      <label class="avatar-choice"><input type="radio" name="avatar" checked><span class="ava-ico">üë®‚Äçüíº</span></label>
      <label class="avatar-choice"><input type="radio" name="avatar"><span class="ava-ico">üë©‚Äçüíº</span></label>
    </div>
    <div class="avatar-modal-actions">
      <button class="btn modal-avatar-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn modal-avatar-cancel">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<div id="blur-overlay" class="blur-overlay" style="display:none;"></div>

<div class="modal-create modal-create-project" id="modal-create-project" style="display:none;">
  <div class="modal-window-created">
    <h3>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h3>
    <form id="create-project-form" autocomplete="off">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
        <input type="text" class="input-field" name="project_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞">
      </label>
      <label>–û–ø–∏—Å–∞–Ω–∏–µ
        <textarea class="input-field" name="project_description" rows="3" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç..."></textarea>
      </label>
      <label>–¢–∏–ø
        <select class="input-field" name="project_type">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
          <option value="public">–û—Ç–∫—Ä—ã—Ç—ã–π</option>
          <option value="private">–ó–∞–∫—Ä—ã—Ç—ã–π</option>
        </select>
      </label>
      <div class="modal-create-actions">
        <button type="submit" class="btn create-btn">–°–æ–∑–¥–∞—Ç—å</button>
        <button type="button" class="btn cancel-btn" onclick="this.closest('.modal-create').style.display='none';document.getElementById('blur-overlay').style.display='none';">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </form>
  </div>
</div>

<div class="modal-create modal-create-task" id="modal-create-task" style="display:none;">
  <div class="modal-window-created">
    <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</h3>
    <form autocomplete="off">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        <input type="text" class="input-field" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
      </label>
      <label>–û–ø–∏—Å–∞–Ω–∏–µ
        <textarea class="input-field" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"></textarea>
      </label>
      <label>–°—Ç–∞—Ç—É—Å
        <select class="input-field">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
          <option>–í —Ä–∞–±–æ—Ç–µ</option>
          <option>–ì–æ—Ç–æ–≤–æ</option>
        </select>
      </label>
      <div class="modal-create-actions">
        <button class="btn create-btn">–°–æ–∑–¥–∞—Ç—å</button>
        <button class="btn cancel-btn" onclick="this.closest('.modal-create').style.display='none';document.getElementById('blur-overlay').style.display='none';return false;">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </form>
  </div>
</div>
<script>
(function() {
  const navBtns = document.querySelectorAll('.sidebar-nav .sidebar-btn[data-section]');
  const appContent = document.getElementById('app-content');
  const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');

  function toggleSidebar() {
    console.log('–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞');

    if (document.body.classList.contains('sidebar-collapsed')) {
      document.body.classList.remove('sidebar-collapsed');
      localStorage.setItem('sidebarState', 'expanded');
      console.log('–°–∞–π–¥–±–∞—Ä —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç');
    } else {
      document.body.classList.add('sidebar-collapsed');
      localStorage.setItem('sidebarState', 'collapsed');
      console.log('–°–∞–π–¥–±–∞—Ä —Å–≤–µ—Ä–Ω—É—Ç');
    }
  }

  function initSidebar() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∞–π–¥–±–∞—Ä–∞...');

    if (!localStorage.getItem('sidebarButtonShown')) {
      toggleSidebarBtn.classList.add('pulse-animation');

      toggleSidebarBtn.addEventListener('click', function() {
        toggleSidebarBtn.classList.remove('pulse-animation');
        localStorage.setItem('sidebarButtonShown', 'true');
      }, { once: true });

      setTimeout(function() {
        toggleSidebarBtn.classList.remove('pulse-animation');
      }, 5000);
    }

    toggleSidebarBtn.addEventListener('click', function(e) {
      console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —Å–∞–π–¥–±–∞—Ä–∞!');
      toggleSidebar();
      e.preventDefault();
      e.stopPropagation();
    });

    if (localStorage.getItem('sidebarState') === 'collapsed') {
      document.body.classList.add('sidebar-collapsed');
    }

    if (window.innerWidth <= 700 && !localStorage.getItem('sidebarState')) {
      document.body.classList.add('sidebar-collapsed');
    }

    navBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        if (window.innerWidth <= 700) {
          document.body.classList.add('sidebar-collapsed');
        }
      });
    });
  }

  initSidebar();

  window.addEventListener('resize', function() {
    if (window.innerWidth <= 700 && !localStorage.getItem('sidebarState')) {
      document.body.classList.add('sidebar-collapsed');
    }
  });

  function filterTasksKanban(query) {
    const ids = ['tasks-new', 'tasks-inprogress', 'tasks-review', 'tasks-done'];
    ids.forEach(colId => {
      const col = document.getElementById(colId);
      if (!col) return;
      const cards = col.children;
      for (let i = 0; i < cards.length; i++) {
        const cardText = cards[i].innerText || cards[i].textContent || '';
        if (!query || cardText.toLowerCase().includes(query.toLowerCase())) {
          cards[i].style.display = '';
        } else {
          cards[i].style.display = 'none';
        }
      }
    });
  }

  function setActiveSection(section) {
    navBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.section === section));
    if (section === 'profile') {
      appContent.innerHTML = `
        <div class="profile-cover-block">
          <div class="profile-cover-bg"></div>
          <div class="profile-cover-content"></div>
          <div class="profile-main-card profile-main-card--edit">
            <div class="profile-main profile-main--split">
              <div class="profile-main-left">
                <div class="profile-avatar-wrap">
                  <span class="profile-avatar">üë®‚Äçüíº</span>
                  <div class="avatar-overlay">
                    <span class="avatar-plus">+</span>
                  </div>
                </div>
                <div class="profile-main-info">
                  <div class="profile-main-username">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</div>
                  <div class="profile-main-email">ivan.ivanov@mail.ru</div>
                  <div class=""> </div>
                </div>
              </div>
              <div class="profile-main-right">
                <form class="profile-edit-form" autocomplete="off" onsubmit="return false;">
                  <label>–§–ò–û <input type="text" class="input-field" value="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"></label>
                  <label>–õ–æ–≥–∏–Ω <input type="text" class="input-field login-field" value="ivanov"></label>
                  <label>Email <input type="email" class="input-field" value="ivan.ivanov@mail.ru"></label>
                  <label>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è <textarea class="input-field bio-field" rows="3"></textarea></label>
                  <div class="profile-edit-actions">
                    <button class="btn edit-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
                    <button class="btn edit-delete" type="button">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                    <button class="btn edit-logout" type="button">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      `;

      setTimeout(function() {
        const avatarWrap = appContent.querySelector('.profile-avatar-wrap');
        const modalAvatarOverlay = document.getElementById('modal-avatar-overlay');
        const blurOverlay = document.getElementById('blur-overlay');
        if (avatarWrap && modalAvatarOverlay && blurOverlay) {
          avatarWrap.addEventListener('click', function() {
            modalAvatarOverlay.style.display = 'flex';
            blurOverlay.style.display = 'block';
          });
        }
        if (modalAvatarOverlay && blurOverlay) {
          const cancelBtn = modalAvatarOverlay.querySelector('.modal-avatar-cancel');
          const saveBtn = modalAvatarOverlay.querySelector('.modal-avatar-save');
          function closeModal() {
            modalAvatarOverlay.style.display = 'none';
            blurOverlay.style.display = 'none';
          }
          if (cancelBtn) cancelBtn.onclick = closeModal;
          if (saveBtn) saveBtn.onclick = function(e) { e.preventDefault(); closeModal(); };
          blurOverlay.onclick = closeModal;
        }
      }, 50);

    } else if (section === 'projects') {
      appContent.innerHTML = `
        <section class="projects section active">
          <h2>–ü—Ä–æ–µ–∫—Ç—ã</h2>
          <div class="table-block">
            <table>
              <thead>
                <tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¢–∏–ø</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</th></tr>
              </thead>
              <tbody id="projects-table-body"><!-- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ --></tbody>
            </table>
            <button class="btn primary" style="margin-top:1.3em;" onclick="document.getElementById('modal-create-project').style.display='flex';document.getElementById('blur-overlay').style.display='block';">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
          </div>
        </section>
      `;

      setTimeout(fetchProjects, 100);
    } else if (section === 'tasks') {
      appContent.innerHTML = `
        <section class="tasks section active">
          <h2>–ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>
          <div class="task-search-bar">
            <input type="text" id="kanban-search" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á..." class="kanban-search">
            <button class="btn search-btn" id="kanban-search-btn" title="–ù–∞–π—Ç–∏ –∑–∞–¥–∞—á—É"><span class="search-icon">üîç</span></button>
          </div>
          <div class="kanban-board">
            <div class="kanban-col" data-status="new">
              <div class="kanban-col-title">–ù–æ–≤—ã–µ</div>
              <div class="kanban-cards" id="tasks-new"><!-- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ --></div>
            </div>
            <div class="kanban-col" data-status="inprogress">
              <div class="kanban-col-title">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
              <div class="kanban-cards" id="tasks-inprogress"></div>
            </div>
            <div class="kanban-col" data-status="review">
              <div class="kanban-col-title">–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å</div>
              <div class="kanban-cards" id="tasks-review"></div>
            </div>
            <div class="kanban-col" data-status="done">
              <div class="kanban-col-title">–ì–æ—Ç–æ–≤–æ</div>
              <div class="kanban-cards" id="tasks-done"></div>
            </div>
          </div>
        </section>
      `;
      setTimeout(function() {
        const searchInput = document.getElementById('kanban-search');
        const searchBtn = document.getElementById('kanban-search-btn');
        if (searchInput && searchBtn) {
          searchBtn.onclick = function() {
            filterTasksKanban(searchInput.value.trim());
          };
          searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') searchBtn.click();
          });
        }
      }, 50);
    } else if (section === 'extra') {
      appContent.innerHTML = `
        <section class="other section active">
          <h2>–ß—Ç–æ-—Ç–æ –µ—â—ë</h2>
          <p>–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.</p>
        </section>
      `;
    }
  }
  navBtns.forEach(btn => {
    btn.addEventListener('click', () => setActiveSection(btn.dataset.section));
  });
  setActiveSection('profile');

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
  const themeBtn = document.getElementById('theme-btn-sidebar');
  if (themeBtn) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-theme');
      themeBtn.querySelector('.theme-icon').textContent = '‚òÄÔ∏è';
    }

    themeBtn.addEventListener('click', function() {
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–º—É
      if (document.body.classList.contains('dark-theme')) {
        document.body.classList.remove('dark-theme');
        localStorage.setItem('theme', 'light');
        themeBtn.querySelector('.theme-icon').textContent = 'üåô';
      } else {
        document.body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
        themeBtn.querySelector('.theme-icon').textContent = '‚òÄÔ∏è';
      }
    });
  }
})();
</script>
<script src="js/projects.js"></script>
<script src="js/users.js"></script>
</body>
</html>
